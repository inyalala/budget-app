<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prof's Financial Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.10.3/umd/Recharts.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/zustand@4.4.7/umd/vanilla.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%); }
        .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .progress-bar { transition: width 0.5s ease-in-out; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        const { 
            LineChart, Line, AreaChart, Area, BarChart, Bar, PieChart, Pie, Cell,
            XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer 
        } = Recharts;

        // ==================== CONSTANTS ====================
        const CURRENCIES = {
            USD: { symbol: '$', name: 'US Dollar' },
            TZS: { symbol: 'TSh', name: 'Tanzanian Shilling' },
            KES: { symbol: 'KSh', name: 'Kenyan Shilling' }
        };

        const EXPENSE_CATEGORIES = [
            'Housing', 'Utilities', 'Groceries', 'Dining', 'Transportation',
            'Healthcare', 'Entertainment', 'Shopping', 'Subscriptions',
            'Family Support', 'Savings', 'Investments', 'Debt Payment', 'Other'
        ];

        const INCOME_CATEGORIES = ['Salary', 'Interest', 'Dividends', 'Gifts', 'Refunds', 'Other'];

        const ACCOUNT_TYPES = ['Wallet', 'Bank Account', 'M-Pesa', 'Cash', 'MMF', 'Emergency Fund', 'Big Wallet'];

        const COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'];

        // ==================== UTILITY FUNCTIONS ====================
        const formatCurrency = (amount, currency = 'KES') => {
            const formatted = new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(amount);
            return `${CURRENCIES[currency].symbol} ${formatted}`;
        };

        const generateId = () => Math.random().toString(36).substr(2, 9);

        const getMonthName = (date) => new Date(date).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

        // ==================== LOCAL STORAGE HELPERS ====================
        const saveToStorage = (key, data) => {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Storage save error:', e);
            }
        };

        const loadFromStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('Storage load error:', e);
                return defaultValue;
            }
        };

        // ==================== INITIAL STATE ====================
        const getInitialState = () => ({
            transactions: loadFromStorage('transactions', []),
            accounts: loadFromStorage('accounts', [
                { id: '1', name: 'Bank Account', type: 'Bank Account', balance: 0, currency: 'TZS' },
                { id: '2', name: 'M-Pesa', type: 'M-Pesa', balance: 0, currency: 'TZS' },
                { id: '3', name: 'Wallet', type: 'Wallet', balance: 0, currency: 'TZS' },
                { id: '4', name: 'MMF Kenya', type: 'MMF', balance: 0, currency: 'KES' }
            ]),
            goals: loadFromStorage('goals', []),
            subscriptions: loadFromStorage('subscriptions', []),
            budgets: loadFromStorage('budgets', {}),
            exchangeRates: loadFromStorage('exchangeRates', {
                USD_TZS: 2700,
                USD_KES: 129,
                TZS_KES: 0.047,
                lastUpdated: null
            }),
            settings: loadFromStorage('settings', {
                baseCurrency: 'KES',
                theme: 'dark',
                autoFetchRates: true
            })
        });

        // ==================== MAIN APP COMPONENT ====================
        const App = () => {
            const [state, setState] = useState(getInitialState);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showAddModal, setShowAddModal] = useState(null);
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
            const [notification, setNotification] = useState(null);

            // Persist state changes
            useEffect(() => {
                saveToStorage('transactions', state.transactions);
                saveToStorage('accounts', state.accounts);
                saveToStorage('goals', state.goals);
                saveToStorage('subscriptions', state.subscriptions);
                saveToStorage('budgets', state.budgets);
                saveToStorage('exchangeRates', state.exchangeRates);
                saveToStorage('settings', state.settings);
            }, [state]);

            // Fetch exchange rates
            useEffect(() => {
                if (state.settings.autoFetchRates) {
                    fetchExchangeRates();
                }
            }, []);

            const fetchExchangeRates = async () => {
                try {
                    // Using a free exchange rate API
                    const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                    const data = await response.json();
                    setState(prev => ({
                        ...prev,
                        exchangeRates: {
                            USD_TZS: data.rates.TZS || 2700,
                            USD_KES: data.rates.KES || 129,
                            TZS_KES: (data.rates.KES / data.rates.TZS) || 0.047,
                            lastUpdated: new Date().toISOString()
                        }
                    }));
                    showNotification('Exchange rates updated!', 'success');
                } catch (error) {
                    console.error('Failed to fetch rates:', error);
                }
            };

            const showNotification = (message, type = 'info') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const convertCurrency = (amount, from, to) => {
                if (from === to) return amount;
                const rates = state.exchangeRates;
                
                // Convert to USD first, then to target
                let usdAmount = amount;
                if (from === 'TZS') usdAmount = amount / rates.USD_TZS;
                else if (from === 'KES') usdAmount = amount / rates.USD_KES;
                
                if (to === 'USD') return usdAmount;
                if (to === 'TZS') return usdAmount * rates.USD_TZS;
                if (to === 'KES') return usdAmount * rates.USD_KES;
                
                return amount;
            };

            const addTransaction = (transaction) => {
                const newTransaction = {
                    ...transaction,
                    id: generateId(),
                    createdAt: new Date().toISOString()
                };
                setState(prev => ({
                    ...prev,
                    transactions: [...prev.transactions, newTransaction]
                }));
                
                // Update account balance if applicable
                if (transaction.accountId) {
                    updateAccountBalance(transaction.accountId, transaction.type === 'income' ? transaction.amount : -transaction.amount);
                }
                
                showNotification('Transaction added!', 'success');
                setShowAddModal(null);
            };

            const updateAccountBalance = (accountId, delta) => {
                setState(prev => ({
                    ...prev,
                    accounts: prev.accounts.map(acc => 
                        acc.id === accountId 
                            ? { ...acc, balance: acc.balance + delta }
                            : acc
                    )
                }));
            };

            const addGoal = (goal) => {
                const newGoal = {
                    ...goal,
                    id: generateId(),
                    saved: 0,
                    createdAt: new Date().toISOString()
                };
                setState(prev => ({
                    ...prev,
                    goals: [...prev.goals, newGoal]
                }));
                showNotification('Goal created!', 'success');
                setShowAddModal(null);
            };

            const updateGoalProgress = (goalId, amount) => {
                setState(prev => ({
                    ...prev,
                    goals: prev.goals.map(g => 
                        g.id === goalId ? { ...g, saved: g.saved + amount } : g
                    )
                }));
            };

            const addSubscription = (subscription) => {
                const newSub = {
                    ...subscription,
                    id: generateId()
                };
                setState(prev => ({
                    ...prev,
                    subscriptions: [...prev.subscriptions, newSub]
                }));
                showNotification('Subscription added!', 'success');
                setShowAddModal(null);
            };

            const addAccount = (account) => {
                const newAccount = {
                    ...account,
                    id: generateId()
                };
                setState(prev => ({
                    ...prev,
                    accounts: [...prev.accounts, newAccount]
                }));
                showNotification('Account added!', 'success');
                setShowAddModal(null);
            };

            const deleteItem = (type, id) => {
                setState(prev => ({
                    ...prev,
                    [type]: prev[type].filter(item => item.id !== id)
                }));
                showNotification('Deleted successfully!', 'info');
            };

            const exportToExcel = (type = 'monthly') => {
                const wb = XLSX.utils.book_new();
                
                if (type === 'monthly') {
                    // Filter transactions for selected month
                    const monthTransactions = state.transactions.filter(t => 
                        t.date?.startsWith(selectedMonth)
                    );
                    
                    const ws = XLSX.utils.json_to_sheet(monthTransactions.map(t => ({
                        Date: t.date,
                        Description: t.description,
                        Category: t.category,
                        Type: t.type,
                        Amount: t.amount,
                        Currency: t.currency,
                        'Amount (KES)': convertCurrency(t.amount, t.currency, 'KES').toFixed(2)
                    })));
                    XLSX.utils.book_append_sheet(wb, ws, `Transactions ${selectedMonth}`);
                    
                    // Summary sheet
                    const summary = calculateMonthlySummary(monthTransactions);
                    const summaryWs = XLSX.utils.json_to_sheet([summary]);
                    XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');
                    
                } else {
                    // Yearly report
                    const yearTransactions = state.transactions.filter(t => 
                        t.date?.startsWith(selectedMonth.slice(0, 4))
                    );
                    
                    const ws = XLSX.utils.json_to_sheet(yearTransactions.map(t => ({
                        Date: t.date,
                        Description: t.description,
                        Category: t.category,
                        Type: t.type,
                        Amount: t.amount,
                        Currency: t.currency,
                        'Amount (KES)': convertCurrency(t.amount, t.currency, 'KES').toFixed(2)
                    })));
                    XLSX.utils.book_append_sheet(wb, ws, 'All Transactions');
                    
                    // Monthly breakdown
                    const monthlyData = getMonthlyBreakdown(yearTransactions);
                    const monthlyWs = XLSX.utils.json_to_sheet(monthlyData);
                    XLSX.utils.book_append_sheet(wb, monthlyWs, 'Monthly Breakdown');
                    
                    // Goals
                    const goalsWs = XLSX.utils.json_to_sheet(state.goals.map(g => ({
                        Name: g.name,
                        Target: g.target,
                        Saved: g.saved,
                        Currency: g.currency,
                        Progress: `${((g.saved / g.target) * 100).toFixed(1)}%`,
                        Deadline: g.deadline
                    })));
                    XLSX.utils.book_append_sheet(wb, goalsWs, 'Goals');
                    
                    // Accounts
                    const accountsWs = XLSX.utils.json_to_sheet(state.accounts.map(a => ({
                        Name: a.name,
                        Type: a.type,
                        Balance: a.balance,
                        Currency: a.currency,
                        'Balance (KES)': convertCurrency(a.balance, a.currency, 'KES').toFixed(2)
                    })));
                    XLSX.utils.book_append_sheet(wb, accountsWs, 'Accounts');
                    
                    // Subscriptions
                    const subsWs = XLSX.utils.json_to_sheet(state.subscriptions);
                    XLSX.utils.book_append_sheet(wb, subsWs, 'Subscriptions');
                }
                
                const filename = type === 'monthly' 
                    ? `Budget_Report_${selectedMonth}.xlsx`
                    : `Annual_Report_${selectedMonth.slice(0, 4)}.xlsx`;
                    
                XLSX.writeFile(wb, filename);
                showNotification(`${type === 'monthly' ? 'Monthly' : 'Annual'} report exported!`, 'success');
            };

            const calculateMonthlySummary = (transactions) => {
                const income = transactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, 'KES'), 0);
                const expenses = transactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, 'KES'), 0);
                    
                return {
                    'Total Income (KES)': income.toFixed(2),
                    'Total Expenses (KES)': expenses.toFixed(2),
                    'Net Savings (KES)': (income - expenses).toFixed(2),
                    'Savings Rate': income > 0 ? `${((income - expenses) / income * 100).toFixed(1)}%` : '0%'
                };
            };

            const getMonthlyBreakdown = (transactions) => {
                const months = {};
                transactions.forEach(t => {
                    const month = t.date?.slice(0, 7);
                    if (!month) return;
                    if (!months[month]) months[month] = { income: 0, expenses: 0 };
                    const amount = convertCurrency(t.amount, t.currency, 'KES');
                    if (t.type === 'income') months[month].income += amount;
                    else months[month].expenses += amount;
                });
                
                return Object.entries(months).map(([month, data]) => ({
                    Month: month,
                    Income: data.income.toFixed(2),
                    Expenses: data.expenses.toFixed(2),
                    Net: (data.income - data.expenses).toFixed(2)
                })).sort((a, b) => a.Month.localeCompare(b.Month));
            };

            const importFromExcel = async (file) => {
                try {
                    const data = await file.arrayBuffer();
                    const workbook = XLSX.read(data);
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);
                    
                    // Parse and add transactions
                    const newTransactions = jsonData.map(row => ({
                        id: generateId(),
                        date: row.Date || row.date,
                        description: row.Description || row.description || row[0] || '',
                        amount: parseFloat(row.TSH || row.Amount || row.amount || 0),
                        currency: row.Currency || 'TZS',
                        category: row.Category || 'Other',
                        type: 'expense',
                        createdAt: new Date().toISOString()
                    })).filter(t => t.amount > 0);
                    
                    setState(prev => ({
                        ...prev,
                        transactions: [...prev.transactions, ...newTransactions]
                    }));
                    
                    showNotification(`Imported ${newTransactions.length} transactions!`, 'success');
                } catch (error) {
                    console.error('Import error:', error);
                    showNotification('Import failed. Check file format.', 'error');
                }
            };

            // Calculate totals
            const totals = useMemo(() => {
                const baseCurrency = state.settings.baseCurrency;
                
                const totalAccounts = state.accounts.reduce((sum, acc) => 
                    sum + convertCurrency(acc.balance, acc.currency, baseCurrency), 0);
                
                const monthTransactions = state.transactions.filter(t => 
                    t.date?.startsWith(selectedMonth)
                );
                
                const monthlyIncome = monthTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);
                
                const monthlyExpenses = monthTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + convertCurrency(t.amount, t.currency, baseCurrency), 0);
                
                const totalGoals = state.goals.reduce((sum, g) => 
                    sum + convertCurrency(g.target, g.currency, baseCurrency), 0);
                
                const totalSaved = state.goals.reduce((sum, g) => 
                    sum + convertCurrency(g.saved, g.currency, baseCurrency), 0);
                
                const monthlySubscriptions = state.subscriptions
                    .filter(s => s.frequency === 'monthly')
                    .reduce((sum, s) => sum + convertCurrency(s.amount, s.currency, baseCurrency), 0);
                
                return {
                    totalAccounts,
                    monthlyIncome,
                    monthlyExpenses,
                    netSavings: monthlyIncome - monthlyExpenses,
                    totalGoals,
                    totalSaved,
                    goalsProgress: totalGoals > 0 ? (totalSaved / totalGoals) * 100 : 0,
                    monthlySubscriptions
                };
            }, [state, selectedMonth, convertCurrency]);

            return (
                <div className="min-h-screen bg-slate-900">
                    {/* Notification */}
                    {notification && (
                        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${
                            notification.type === 'success' ? 'bg-green-600' :
                            notification.type === 'error' ? 'bg-red-600' : 'bg-blue-600'
                        }`}>
                            {notification.message}
                        </div>
                    )}

                    {/* Header */}
                    <header className="gradient-bg border-b border-slate-700 sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                        <span className="text-xl">üí∞</span>
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold">Financial Command Center</h1>
                                        <p className="text-sm text-slate-400">Prof's Personal Finance</p>
                                    </div>
                                </div>
                                
                                <div className="flex items-center gap-4">
                                    <input
                                        type="month"
                                        value={selectedMonth}
                                        onChange={(e) => setSelectedMonth(e.target.value)}
                                        className="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm"
                                    />
                                    
                                    <div className="text-sm text-slate-400">
                                        1 USD = {state.exchangeRates.USD_TZS.toLocaleString()} TZS = {state.exchangeRates.USD_KES.toLocaleString()} KES
                                    </div>
                                    
                                    <button
                                        onClick={fetchExchangeRates}
                                        className="p-2 hover:bg-slate-700 rounded-lg transition"
                                        title="Refresh rates"
                                    >
                                        üîÑ
                                    </button>
                                </div>
                            </div>
                            
                            {/* Navigation */}
                            <nav className="flex gap-1 mt-4 overflow-x-auto">
                                {['dashboard', 'transactions', 'accounts', 'goals', 'subscriptions', 'reports', 'settings'].map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-4 py-2 rounded-lg text-sm font-medium transition whitespace-nowrap ${
                                            activeTab === tab
                                                ? 'bg-blue-600 text-white'
                                                : 'text-slate-400 hover:bg-slate-700 hover:text-white'
                                        }`}
                                    >
                                        {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                    </button>
                                ))}
                            </nav>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-6">
                        {activeTab === 'dashboard' && (
                            <Dashboard
                                totals={totals}
                                state={state}
                                selectedMonth={selectedMonth}
                                convertCurrency={convertCurrency}
                                formatCurrency={formatCurrency}
                            />
                        )}
                        
                        {activeTab === 'transactions' && (
                            <TransactionsTab
                                transactions={state.transactions}
                                accounts={state.accounts}
                                selectedMonth={selectedMonth}
                                onAdd={() => setShowAddModal('transaction')}
                                onDelete={(id) => deleteItem('transactions', id)}
                                convertCurrency={convertCurrency}
                                formatCurrency={formatCurrency}
                                onImport={importFromExcel}
                            />
                        )}
                        
                        {activeTab === 'accounts' && (
                            <AccountsTab
                                accounts={state.accounts}
                                onAdd={() => setShowAddModal('account')}
                                onDelete={(id) => deleteItem('accounts', id)}
                                convertCurrency={convertCurrency}
                                formatCurrency={formatCurrency}
                                baseCurrency={state.settings.baseCurrency}
                            />
                        )}
                        
                        {activeTab === 'goals' && (
                            <GoalsTab
                                goals={state.goals}
                                onAdd={() => setShowAddModal('goal')}
                                onDelete={(id) => deleteItem('goals', id)}
                                onUpdateProgress={updateGoalProgress}
                                formatCurrency={formatCurrency}
                            />
                        )}
                        
                        {activeTab === 'subscriptions' && (
                            <SubscriptionsTab
                                subscriptions={state.subscriptions}
                                onAdd={() => setShowAddModal('subscription')}
                                onDelete={(id) => deleteItem('subscriptions', id)}
                                convertCurrency={convertCurrency}
                                formatCurrency={formatCurrency}
                                baseCurrency={state.settings.baseCurrency}
                            />
                        )}
                        
                        {activeTab === 'reports' && (
                            <ReportsTab
                                state={state}
                                selectedMonth={selectedMonth}
                                convertCurrency={convertCurrency}
                                formatCurrency={formatCurrency}
                                onExport={exportToExcel}
                            />
                        )}
                        
                        {activeTab === 'settings' && (
                            <SettingsTab
                                settings={state.settings}
                                exchangeRates={state.exchangeRates}
                                onUpdateSettings={(updates) => setState(prev => ({
                                    ...prev,
                                    settings: { ...prev.settings, ...updates }
                                }))}
                                onUpdateRates={(updates) => setState(prev => ({
                                    ...prev,
                                    exchangeRates: { ...prev.exchangeRates, ...updates }
                                }))}
                                onFetchRates={fetchExchangeRates}
                                onExportData={() => {
                                    const data = JSON.stringify(state, null, 2);
                                    const blob = new Blob([data], { type: 'application/json' });
                                    const url = URL.createObjectURL(blob);
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.download = `budget_backup_${new Date().toISOString().slice(0, 10)}.json`;
                                    a.click();
                                    showNotification('Backup exported!', 'success');
                                }}
                                onImportData={(file) => {
                                    const reader = new FileReader();
                                    reader.onload = (e) => {
                                        try {
                                            const data = JSON.parse(e.target.result);
                                            setState(data);
                                            showNotification('Data restored!', 'success');
                                        } catch (err) {
                                            showNotification('Invalid backup file', 'error');
                                        }
                                    };
                                    reader.readAsText(file);
                                }}
                            />
                        )}
                    </main>

                    {/* Modals */}
                    {showAddModal === 'transaction' && (
                        <TransactionModal
                            accounts={state.accounts}
                            onSave={addTransaction}
                            onClose={() => setShowAddModal(null)}
                        />
                    )}
                    
                    {showAddModal === 'goal' && (
                        <GoalModal
                            onSave={addGoal}
                            onClose={() => setShowAddModal(null)}
                        />
                    )}
                    
                    {showAddModal === 'subscription' && (
                        <SubscriptionModal
                            onSave={addSubscription}
                            onClose={() => setShowAddModal(null)}
                        />
                    )}
                    
                    {showAddModal === 'account' && (
                        <AccountModal
                            onSave={addAccount}
                            onClose={() => setShowAddModal(null)}
                        />
                    )}
                </div>
            );
        };

        // ==================== DASHBOARD COMPONENT ====================
        const Dashboard = ({ totals, state, selectedMonth, convertCurrency, formatCurrency }) => {
            const baseCurrency = state.settings.baseCurrency;
            
            // Prepare chart data
            const monthlyData = useMemo(() => {
                const months = {};
                state.transactions.forEach(t => {
                    const month = t.date?.slice(0, 7);
                    if (!month) return;
                    if (!months[month]) months[month] = { month, income: 0, expenses: 0 };
                    const amount = convertCurrency(t.amount, t.currency, baseCurrency);
                    if (t.type === 'income') months[month].income += amount;
                    else months[month].expenses += amount;
                });
                return Object.values(months).sort((a, b) => a.month.localeCompare(b.month)).slice(-6);
            }, [state.transactions, convertCurrency, baseCurrency]);

            const categoryData = useMemo(() => {
                const cats = {};
                state.transactions
                    .filter(t => t.date?.startsWith(selectedMonth) && t.type === 'expense')
                    .forEach(t => {
                        if (!cats[t.category]) cats[t.category] = 0;
                        cats[t.category] += convertCurrency(t.amount, t.currency, baseCurrency);
                    });
                return Object.entries(cats)
                    .map(([name, value]) => ({ name, value }))
                    .sort((a, b) => b.value - a.value)
                    .slice(0, 8);
            }, [state.transactions, selectedMonth, convertCurrency, baseCurrency]);

            return (
                <div className="space-y-6">
                    {/* Summary Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <SummaryCard
                            title="Total Net Worth"
                            value={formatCurrency(totals.totalAccounts, baseCurrency)}
                            icon="üíé"
                            color="blue"
                        />
                        <SummaryCard
                            title="Monthly Income"
                            value={formatCurrency(totals.monthlyIncome, baseCurrency)}
                            icon="üìà"
                            color="green"
                        />
                        <SummaryCard
                            title="Monthly Expenses"
                            value={formatCurrency(totals.monthlyExpenses, baseCurrency)}
                            icon="üìâ"
                            color="red"
                        />
                        <SummaryCard
                            title="Net Savings"
                            value={formatCurrency(totals.netSavings, baseCurrency)}
                            icon={totals.netSavings >= 0 ? "‚úÖ" : "‚ö†Ô∏è"}
                            color={totals.netSavings >= 0 ? "green" : "orange"}
                        />
                    </div>

                    {/* Charts Row */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Income vs Expenses Chart */}
                        <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                            <h3 className="text-lg font-semibold mb-4">Income vs Expenses (Last 6 Months)</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <BarChart data={monthlyData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                                    <XAxis dataKey="month" stroke="#9ca3af" />
                                    <YAxis stroke="#9ca3af" tickFormatter={(v) => `${(v/1000).toFixed(0)}K`} />
                                    <Tooltip 
                                        contentStyle={{ backgroundColor: '#1e293b', border: 'none' }}
                                        formatter={(value) => formatCurrency(value, baseCurrency)}
                                    />
                                    <Legend />
                                    <Bar dataKey="income" fill="#10b981" name="Income" radius={[4, 4, 0, 0]} />
                                    <Bar dataKey="expenses" fill="#ef4444" name="Expenses" radius={[4, 4, 0, 0]} />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Category Breakdown */}
                        <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                            <h3 className="text-lg font-semibold mb-4">Expenses by Category</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <PieChart>
                                    <Pie
                                        data={categoryData}
                                        cx="50%"
                                        cy="50%"
                                        outerRadius={100}
                                        dataKey="value"
                                        label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}
                                    >
                                        {categoryData.map((entry, index) => (
                                            <Cell key={index} fill={COLORS[index % COLORS.length]} />
                                        ))}
                                    </Pie>
                                    <Tooltip formatter={(value) => formatCurrency(value, baseCurrency)} />
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Goals Progress */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-semibold">Savings Goals Progress</h3>
                            <span className="text-sm text-slate-400">
                                Overall: {totals.goalsProgress.toFixed(1)}%
                            </span>
                        </div>
                        <div className="space-y-4">
                            {state.goals.slice(0, 5).map(goal => {
                                const progress = (goal.saved / goal.target) * 100;
                                return (
                                    <div key={goal.id} className="space-y-2">
                                        <div className="flex justify-between text-sm">
                                            <span>{goal.name}</span>
                                            <span>
                                                {formatCurrency(goal.saved, goal.currency)} / {formatCurrency(goal.target, goal.currency)}
                                            </span>
                                        </div>
                                        <div className="h-3 bg-slate-700 rounded-full overflow-hidden">
                                            <div
                                                className="h-full bg-gradient-to-r from-blue-500 to-green-500 progress-bar"
                                                style={{ width: `${Math.min(progress, 100)}%` }}
                                            />
                                        </div>
                                    </div>
                                );
                            })}
                            {state.goals.length === 0 && (
                                <p className="text-slate-400 text-center py-4">No goals set yet. Add your first savings goal!</p>
                            )}
                        </div>
                    </div>

                    {/* Accounts Overview */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <h3 className="text-lg font-semibold mb-4">Accounts Overview</h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {state.accounts.map(account => (
                                <div key={account.id} className="bg-slate-700 rounded-lg p-4">
                                    <p className="text-sm text-slate-400">{account.name}</p>
                                    <p className="text-xl font-bold mt-1">
                                        {formatCurrency(account.balance, account.currency)}
                                    </p>
                                    <p className="text-xs text-slate-500 mt-1">{account.type}</p>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Upcoming Subscriptions */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <h3 className="text-lg font-semibold mb-4">Monthly Subscriptions</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="text-left text-slate-400 text-sm">
                                        <th className="pb-3">Service</th>
                                        <th className="pb-3">Amount</th>
                                        <th className="pb-3">Frequency</th>
                                        <th className="pb-3">Next Due</th>
                                    </tr>
                                </thead>
                                <tbody className="text-sm">
                                    {state.subscriptions.slice(0, 5).map(sub => (
                                        <tr key={sub.id} className="border-t border-slate-700">
                                            <td className="py-3">{sub.name}</td>
                                            <td>{formatCurrency(sub.amount, sub.currency)}</td>
                                            <td className="capitalize">{sub.frequency}</td>
                                            <td>{sub.nextDue}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {state.subscriptions.length === 0 && (
                                <p className="text-slate-400 text-center py-4">No subscriptions tracked yet.</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== SUMMARY CARD ====================
        const SummaryCard = ({ title, value, icon, color }) => {
            const colors = {
                blue: 'from-blue-600 to-blue-800',
                green: 'from-green-600 to-green-800',
                red: 'from-red-600 to-red-800',
                orange: 'from-orange-600 to-orange-800'
            };
            
            return (
                <div className={`bg-gradient-to-br ${colors[color]} rounded-xl p-6 card-shadow`}>
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm opacity-80">{title}</p>
                            <p className="text-2xl font-bold mt-1">{value}</p>
                        </div>
                        <span className="text-3xl">{icon}</span>
                    </div>
                </div>
            );
        };

        // ==================== TRANSACTIONS TAB ====================
        const TransactionsTab = ({ transactions, accounts, selectedMonth, onAdd, onDelete, convertCurrency, formatCurrency, onImport }) => {
            const [filter, setFilter] = useState('all');
            const [search, setSearch] = useState('');
            
            const filteredTransactions = transactions
                .filter(t => t.date?.startsWith(selectedMonth))
                .filter(t => filter === 'all' || t.type === filter)
                .filter(t => t.description?.toLowerCase().includes(search.toLowerCase()))
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            return (
                <div className="space-y-6">
                    <div className="flex flex-wrap gap-4 items-center justify-between">
                        <div className="flex gap-2">
                            {['all', 'income', 'expense'].map(f => (
                                <button
                                    key={f}
                                    onClick={() => setFilter(f)}
                                    className={`px-4 py-2 rounded-lg text-sm ${
                                        filter === f ? 'bg-blue-600' : 'bg-slate-700 hover:bg-slate-600'
                                    }`}
                                >
                                    {f.charAt(0).toUpperCase() + f.slice(1)}
                                </button>
                            ))}
                        </div>
                        
                        <div className="flex gap-2">
                            <input
                                type="text"
                                placeholder="Search transactions..."
                                value={search}
                                onChange={(e) => setSearch(e.target.value)}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-sm"
                            />
                            
                            <label className="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm cursor-pointer">
                                üì• Import
                                <input
                                    type="file"
                                    accept=".xlsx,.xls,.csv"
                                    className="hidden"
                                    onChange={(e) => e.target.files[0] && onImport(e.target.files[0])}
                                />
                            </label>
                            
                            <button
                                onClick={onAdd}
                                className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm flex items-center gap-2"
                            >
                                ‚ûï Add Transaction
                            </button>
                        </div>
                    </div>

                    <div className="bg-slate-800 rounded-xl overflow-hidden card-shadow">
                        <table className="w-full">
                            <thead className="bg-slate-700">
                                <tr className="text-left text-slate-400 text-sm">
                                    <th className="p-4">Date</th>
                                    <th className="p-4">Description</th>
                                    <th className="p-4">Category</th>
                                    <th className="p-4">Amount</th>
                                    <th className="p-4">Type</th>
                                    <th className="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredTransactions.map(t => (
                                    <tr key={t.id} className="border-t border-slate-700 hover:bg-slate-750">
                                        <td className="p-4 text-sm">{t.date}</td>
                                        <td className="p-4">{t.description}</td>
                                        <td className="p-4 text-sm text-slate-400">{t.category}</td>
                                        <td className={`p-4 font-medium ${t.type === 'income' ? 'text-green-400' : 'text-red-400'}`}>
                                            {t.type === 'income' ? '+' : '-'}{formatCurrency(t.amount, t.currency)}
                                        </td>
                                        <td className="p-4">
                                            <span className={`px-2 py-1 rounded text-xs ${
                                                t.type === 'income' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'
                                            }`}>
                                                {t.type}
                                            </span>
                                        </td>
                                        <td className="p-4">
                                            <button
                                                onClick={() => onDelete(t.id)}
                                                className="text-red-400 hover:text-red-300 text-sm"
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {filteredTransactions.length === 0 && (
                            <p className="text-slate-400 text-center py-8">No transactions found for this month.</p>
                        )}
                    </div>
                </div>
            );
        };

        // ==================== ACCOUNTS TAB ====================
        const AccountsTab = ({ accounts, onAdd, onDelete, convertCurrency, formatCurrency, baseCurrency }) => {
            const totalValue = accounts.reduce((sum, acc) => 
                sum + convertCurrency(acc.balance, acc.currency, baseCurrency), 0);

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-xl font-bold">All Accounts</h2>
                            <p className="text-slate-400">Total: {formatCurrency(totalValue, baseCurrency)}</p>
                        </div>
                        <button
                            onClick={onAdd}
                            className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm"
                        >
                            ‚ûï Add Account
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {accounts.map(account => (
                            <div key={account.id} className="bg-slate-800 rounded-xl p-6 card-shadow">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h3 className="font-semibold text-lg">{account.name}</h3>
                                        <p className="text-sm text-slate-400">{account.type}</p>
                                    </div>
                                    <button
                                        onClick={() => onDelete(account.id)}
                                        className="text-red-400 hover:text-red-300"
                                    >
                                        üóëÔ∏è
                                    </button>
                                </div>
                                <p className="text-3xl font-bold mt-4">
                                    {formatCurrency(account.balance, account.currency)}
                                </p>
                                <p className="text-sm text-slate-500 mt-1">
                                    ‚âà {formatCurrency(convertCurrency(account.balance, account.currency, baseCurrency), baseCurrency)}
                                </p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ==================== GOALS TAB ====================
        const GoalsTab = ({ goals, onAdd, onDelete, onUpdateProgress, formatCurrency }) => {
            const [addAmount, setAddAmount] = useState({});

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold">Savings Goals</h2>
                        <button
                            onClick={onAdd}
                            className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm"
                        >
                            ‚ûï Add Goal
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {goals.map(goal => {
                            const progress = (goal.saved / goal.target) * 100;
                            const remaining = goal.target - goal.saved;
                            
                            return (
                                <div key={goal.id} className="bg-slate-800 rounded-xl p-6 card-shadow">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 className="font-semibold text-lg">{goal.name}</h3>
                                            {goal.deadline && (
                                                <p className="text-sm text-slate-400">Target: {goal.deadline}</p>
                                            )}
                                        </div>
                                        <button
                                            onClick={() => onDelete(goal.id)}
                                            className="text-red-400 hover:text-red-300"
                                        >
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <div className="flex justify-between text-sm mb-2">
                                            <span>{formatCurrency(goal.saved, goal.currency)}</span>
                                            <span>{formatCurrency(goal.target, goal.currency)}</span>
                                        </div>
                                        <div className="h-4 bg-slate-700 rounded-full overflow-hidden">
                                            <div
                                                className={`h-full progress-bar ${
                                                    progress >= 100 ? 'bg-green-500' : 'bg-gradient-to-r from-blue-500 to-purple-500'
                                                }`}
                                                style={{ width: `${Math.min(progress, 100)}%` }}
                                            />
                                        </div>
                                        <div className="flex justify-between text-sm mt-2">
                                            <span className="text-slate-400">{progress.toFixed(1)}% complete</span>
                                            <span className="text-slate-400">
                                                {remaining > 0 ? `${formatCurrency(remaining, goal.currency)} to go` : '‚úÖ Complete!'}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <input
                                            type="number"
                                            placeholder="Add amount..."
                                            value={addAmount[goal.id] || ''}
                                            onChange={(e) => setAddAmount({ ...addAmount, [goal.id]: e.target.value })}
                                            className="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm"
                                        />
                                        <button
                                            onClick={() => {
                                                if (addAmount[goal.id]) {
                                                    onUpdateProgress(goal.id, parseFloat(addAmount[goal.id]));
                                                    setAddAmount({ ...addAmount, [goal.id]: '' });
                                                }
                                            }}
                                            className="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm"
                                        >
                                            Add
                                        </button>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {goals.length === 0 && (
                        <div className="bg-slate-800 rounded-xl p-12 text-center card-shadow">
                            <p className="text-4xl mb-4">üéØ</p>
                            <p className="text-slate-400">No savings goals yet. Create your first goal!</p>
                        </div>
                    )}
                </div>
            );
        };

        // ==================== SUBSCRIPTIONS TAB ====================
        const SubscriptionsTab = ({ subscriptions, onAdd, onDelete, convertCurrency, formatCurrency, baseCurrency }) => {
            const monthlyTotal = subscriptions
                .filter(s => s.frequency === 'monthly')
                .reduce((sum, s) => sum + convertCurrency(s.amount, s.currency, baseCurrency), 0);
            
            const annualTotal = subscriptions
                .reduce((sum, s) => {
                    const amount = convertCurrency(s.amount, s.currency, baseCurrency);
                    return sum + (s.frequency === 'monthly' ? amount * 12 : amount);
                }, 0);

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <div>
                            <h2 className="text-xl font-bold">Subscriptions</h2>
                            <p className="text-slate-400">
                                Monthly: {formatCurrency(monthlyTotal, baseCurrency)} | 
                                Annual: {formatCurrency(annualTotal, baseCurrency)}
                            </p>
                        </div>
                        <button
                            onClick={onAdd}
                            className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm"
                        >
                            ‚ûï Add Subscription
                        </button>
                    </div>

                    <div className="bg-slate-800 rounded-xl overflow-hidden card-shadow">
                        <table className="w-full">
                            <thead className="bg-slate-700">
                                <tr className="text-left text-slate-400 text-sm">
                                    <th className="p-4">Service</th>
                                    <th className="p-4">Amount</th>
                                    <th className="p-4">Frequency</th>
                                    <th className="p-4">Next Due</th>
                                    <th className="p-4">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {subscriptions.map(sub => (
                                    <tr key={sub.id} className="border-t border-slate-700">
                                        <td className="p-4 font-medium">{sub.name}</td>
                                        <td className="p-4">{formatCurrency(sub.amount, sub.currency)}</td>
                                        <td className="p-4 capitalize">{sub.frequency}</td>
                                        <td className="p-4">{sub.nextDue}</td>
                                        <td className="p-4">
                                            <button
                                                onClick={() => onDelete(sub.id)}
                                                className="text-red-400 hover:text-red-300"
                                            >
                                                üóëÔ∏è
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {subscriptions.length === 0 && (
                            <p className="text-slate-400 text-center py-8">No subscriptions tracked yet.</p>
                        )}
                    </div>
                </div>
            );
        };

        // ==================== REPORTS TAB ====================
        const ReportsTab = ({ state, selectedMonth, convertCurrency, formatCurrency, onExport }) => {
            const baseCurrency = state.settings.baseCurrency;
            const year = selectedMonth.slice(0, 4);
            
            const yearlyData = useMemo(() => {
                const months = {};
                state.transactions
                    .filter(t => t.date?.startsWith(year))
                    .forEach(t => {
                        const month = t.date?.slice(0, 7);
                        if (!month) return;
                        if (!months[month]) months[month] = { month, income: 0, expenses: 0, savings: 0 };
                        const amount = convertCurrency(t.amount, t.currency, baseCurrency);
                        if (t.type === 'income') months[month].income += amount;
                        else months[month].expenses += amount;
                    });
                
                return Object.values(months)
                    .map(m => ({ ...m, savings: m.income - m.expenses }))
                    .sort((a, b) => a.month.localeCompare(b.month));
            }, [state.transactions, year, convertCurrency, baseCurrency]);

            const yearlyTotals = yearlyData.reduce(
                (acc, m) => ({
                    income: acc.income + m.income,
                    expenses: acc.expenses + m.expenses,
                    savings: acc.savings + m.savings
                }),
                { income: 0, expenses: 0, savings: 0 }
            );

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h2 className="text-xl font-bold">Financial Reports</h2>
                        <div className="flex gap-2">
                            <button
                                onClick={() => onExport('monthly')}
                                className="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm"
                            >
                                üìä Export Monthly
                            </button>
                            <button
                                onClick={() => onExport('yearly')}
                                className="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm"
                            >
                                üìà Export Annual
                            </button>
                        </div>
                    </div>

                    {/* Yearly Summary */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-green-900/30 border border-green-800 rounded-xl p-6">
                            <p className="text-green-400 text-sm">Total Income ({year})</p>
                            <p className="text-2xl font-bold">{formatCurrency(yearlyTotals.income, baseCurrency)}</p>
                        </div>
                        <div className="bg-red-900/30 border border-red-800 rounded-xl p-6">
                            <p className="text-red-400 text-sm">Total Expenses ({year})</p>
                            <p className="text-2xl font-bold">{formatCurrency(yearlyTotals.expenses, baseCurrency)}</p>
                        </div>
                        <div className="bg-blue-900/30 border border-blue-800 rounded-xl p-6">
                            <p className="text-blue-400 text-sm">Net Savings ({year})</p>
                            <p className="text-2xl font-bold">{formatCurrency(yearlyTotals.savings, baseCurrency)}</p>
                        </div>
                    </div>

                    {/* Savings Trend */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <h3 className="text-lg font-semibold mb-4">Savings Trend ({year})</h3>
                        <ResponsiveContainer width="100%" height={300}>
                            <AreaChart data={yearlyData}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                                <XAxis dataKey="month" stroke="#9ca3af" />
                                <YAxis stroke="#9ca3af" tickFormatter={(v) => `${(v/1000).toFixed(0)}K`} />
                                <Tooltip 
                                    contentStyle={{ backgroundColor: '#1e293b', border: 'none' }}
                                    formatter={(value) => formatCurrency(value, baseCurrency)}
                                />
                                <Legend />
                                <Area type="monotone" dataKey="savings" stroke="#3b82f6" fill="#3b82f6" fillOpacity={0.3} name="Savings" />
                            </AreaChart>
                        </ResponsiveContainer>
                    </div>

                    {/* Monthly Breakdown Table */}
                    <div className="bg-slate-800 rounded-xl overflow-hidden card-shadow">
                        <h3 className="text-lg font-semibold p-6 pb-0">Monthly Breakdown</h3>
                        <table className="w-full mt-4">
                            <thead className="bg-slate-700">
                                <tr className="text-left text-slate-400 text-sm">
                                    <th className="p-4">Month</th>
                                    <th className="p-4 text-right">Income</th>
                                    <th className="p-4 text-right">Expenses</th>
                                    <th className="p-4 text-right">Savings</th>
                                    <th className="p-4 text-right">Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                {yearlyData.map(m => (
                                    <tr key={m.month} className="border-t border-slate-700">
                                        <td className="p-4">{m.month}</td>
                                        <td className="p-4 text-right text-green-400">{formatCurrency(m.income, baseCurrency)}</td>
                                        <td className="p-4 text-right text-red-400">{formatCurrency(m.expenses, baseCurrency)}</td>
                                        <td className={`p-4 text-right ${m.savings >= 0 ? 'text-blue-400' : 'text-orange-400'}`}>
                                            {formatCurrency(m.savings, baseCurrency)}
                                        </td>
                                        <td className="p-4 text-right text-slate-400">
                                            {m.income > 0 ? `${((m.savings / m.income) * 100).toFixed(1)}%` : '-'}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // ==================== SETTINGS TAB ====================
        const SettingsTab = ({ settings, exchangeRates, onUpdateSettings, onUpdateRates, onFetchRates, onExportData, onImportData }) => {
            return (
                <div className="space-y-6 max-w-2xl">
                    <h2 className="text-xl font-bold">Settings</h2>

                    {/* Currency Settings */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <h3 className="font-semibold mb-4">Currency Settings</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="text-sm text-slate-400 block mb-2">Base Currency</label>
                                <select
                                    value={settings.baseCurrency}
                                    onChange={(e) => onUpdateSettings({ baseCurrency: e.target.value })}
                                    className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                                >
                                    {Object.entries(CURRENCIES).map(([code, { name }]) => (
                                        <option key={code} value={code}>{code} - {name}</option>
                                    ))}
                                </select>
                            </div>
                            
                            <div className="flex items-center justify-between">
                                <span className="text-sm">Auto-fetch exchange rates</span>
                                <button
                                    onClick={() => onUpdateSettings({ autoFetchRates: !settings.autoFetchRates })}
                                    className={`w-12 h-6 rounded-full transition ${
                                        settings.autoFetchRates ? 'bg-blue-600' : 'bg-slate-600'
                                    }`}
                                >
                                    <div className={`w-5 h-5 bg-white rounded-full transition transform ${
                                        settings.autoFetchRates ? 'translate-x-6' : 'translate-x-1'
                                    }`} />
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Exchange Rates */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-semibold">Exchange Rates</h3>
                            <button
                                onClick={onFetchRates}
                                className="text-blue-400 hover:text-blue-300 text-sm"
                            >
                                üîÑ Refresh
                            </button>
                        </div>
                        
                        <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-sm text-slate-400 block mb-2">1 USD = TZS</label>
                                    <input
                                        type="number"
                                        value={exchangeRates.USD_TZS}
                                        onChange={(e) => onUpdateRates({ USD_TZS: parseFloat(e.target.value) })}
                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                                    />
                                </div>
                                <div>
                                    <label className="text-sm text-slate-400 block mb-2">1 USD = KES</label>
                                    <input
                                        type="number"
                                        value={exchangeRates.USD_KES}
                                        onChange={(e) => onUpdateRates({ USD_KES: parseFloat(e.target.value) })}
                                        className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                                    />
                                </div>
                            </div>
                            
                            {exchangeRates.lastUpdated && (
                                <p className="text-sm text-slate-500">
                                    Last updated: {new Date(exchangeRates.lastUpdated).toLocaleString()}
                                </p>
                            )}
                        </div>
                    </div>

                    {/* Data Management */}
                    <div className="bg-slate-800 rounded-xl p-6 card-shadow">
                        <h3 className="font-semibold mb-4">Data Management</h3>
                        
                        <div className="space-y-4">
                            <button
                                onClick={onExportData}
                                className="w-full bg-green-600 hover:bg-green-700 py-3 rounded-lg"
                            >
                                üíæ Export Full Backup (JSON)
                            </button>
                            
                            <label className="block w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg text-center cursor-pointer">
                                üìÇ Restore from Backup
                                <input
                                    type="file"
                                    accept=".json"
                                    className="hidden"
                                    onChange={(e) => e.target.files[0] && onImportData(e.target.files[0])}
                                />
                            </label>
                            
                            <button
                                onClick={() => {
                                    if (confirm('This will clear ALL data. Are you sure?')) {
                                        localStorage.clear();
                                        window.location.reload();
                                    }
                                }}
                                className="w-full bg-red-600 hover:bg-red-700 py-3 rounded-lg"
                            >
                                üóëÔ∏è Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== MODAL COMPONENTS ====================
        const Modal = ({ title, children, onClose }) => (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                <div className="bg-slate-800 rounded-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                    <div className="flex justify-between items-center p-6 border-b border-slate-700">
                        <h2 className="text-lg font-semibold">{title}</h2>
                        <button onClick={onClose} className="text-slate-400 hover:text-white">‚úï</button>
                    </div>
                    <div className="p-6">{children}</div>
                </div>
            </div>
        );

        const TransactionModal = ({ accounts, onSave, onClose }) => {
            const [form, setForm] = useState({
                date: new Date().toISOString().slice(0, 10),
                description: '',
                amount: '',
                currency: 'TZS',
                category: 'Other',
                type: 'expense',
                accountId: accounts[0]?.id || ''
            });

            return (
                <Modal title="Add Transaction" onClose={onClose}>
                    <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                            <button
                                onClick={() => setForm({ ...form, type: 'expense' })}
                                className={`py-2 rounded-lg ${form.type === 'expense' ? 'bg-red-600' : 'bg-slate-700'}`}
                            >
                                Expense
                            </button>
                            <button
                                onClick={() => setForm({ ...form, type: 'income' })}
                                className={`py-2 rounded-lg ${form.type === 'income' ? 'bg-green-600' : 'bg-slate-700'}`}
                            >
                                Income
                            </button>
                        </div>
                        
                        <input
                            type="date"
                            value={form.date}
                            onChange={(e) => setForm({ ...form, date: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <input
                            type="text"
                            placeholder="Description"
                            value={form.description}
                            onChange={(e) => setForm({ ...form, description: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <div className="grid grid-cols-2 gap-4">
                            <input
                                type="number"
                                placeholder="Amount"
                                value={form.amount}
                                onChange={(e) => setForm({ ...form, amount: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            />
                            <select
                                value={form.currency}
                                onChange={(e) => setForm({ ...form, currency: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            >
                                {Object.keys(CURRENCIES).map(c => (
                                    <option key={c} value={c}>{c}</option>
                                ))}
                            </select>
                        </div>
                        
                        <select
                            value={form.category}
                            onChange={(e) => setForm({ ...form, category: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        >
                            {(form.type === 'expense' ? EXPENSE_CATEGORIES : INCOME_CATEGORIES).map(c => (
                                <option key={c} value={c}>{c}</option>
                            ))}
                        </select>
                        
                        <select
                            value={form.accountId}
                            onChange={(e) => setForm({ ...form, accountId: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        >
                            <option value="">No Account</option>
                            {accounts.map(a => (
                                <option key={a.id} value={a.id}>{a.name}</option>
                            ))}
                        </select>
                        
                        <button
                            onClick={() => {
                                if (form.description && form.amount) {
                                    onSave({ ...form, amount: parseFloat(form.amount) });
                                }
                            }}
                            className="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-medium"
                        >
                            Save Transaction
                        </button>
                    </div>
                </Modal>
            );
        };

        const GoalModal = ({ onSave, onClose }) => {
            const [form, setForm] = useState({
                name: '',
                target: '',
                currency: 'KES',
                deadline: ''
            });

            return (
                <Modal title="Add Savings Goal" onClose={onClose}>
                    <div className="space-y-4">
                        <input
                            type="text"
                            placeholder="Goal name (e.g., MacBook Pro M4)"
                            value={form.name}
                            onChange={(e) => setForm({ ...form, name: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <div className="grid grid-cols-2 gap-4">
                            <input
                                type="number"
                                placeholder="Target amount"
                                value={form.target}
                                onChange={(e) => setForm({ ...form, target: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            />
                            <select
                                value={form.currency}
                                onChange={(e) => setForm({ ...form, currency: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            >
                                {Object.keys(CURRENCIES).map(c => (
                                    <option key={c} value={c}>{c}</option>
                                ))}
                            </select>
                        </div>
                        
                        <input
                            type="date"
                            placeholder="Target date"
                            value={form.deadline}
                            onChange={(e) => setForm({ ...form, deadline: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <button
                            onClick={() => {
                                if (form.name && form.target) {
                                    onSave({ ...form, target: parseFloat(form.target) });
                                }
                            }}
                            className="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-medium"
                        >
                            Create Goal
                        </button>
                    </div>
                </Modal>
            );
        };

        const SubscriptionModal = ({ onSave, onClose }) => {
            const [form, setForm] = useState({
                name: '',
                amount: '',
                currency: 'TZS',
                frequency: 'monthly',
                nextDue: ''
            });

            return (
                <Modal title="Add Subscription" onClose={onClose}>
                    <div className="space-y-4">
                        <input
                            type="text"
                            placeholder="Service name (e.g., Netflix)"
                            value={form.name}
                            onChange={(e) => setForm({ ...form, name: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <div className="grid grid-cols-2 gap-4">
                            <input
                                type="number"
                                placeholder="Amount"
                                value={form.amount}
                                onChange={(e) => setForm({ ...form, amount: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            />
                            <select
                                value={form.currency}
                                onChange={(e) => setForm({ ...form, currency: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            >
                                {Object.keys(CURRENCIES).map(c => (
                                    <option key={c} value={c}>{c}</option>
                                ))}
                            </select>
                        </div>
                        
                        <select
                            value={form.frequency}
                            onChange={(e) => setForm({ ...form, frequency: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        >
                            <option value="monthly">Monthly</option>
                            <option value="annual">Annual</option>
                            <option value="quarterly">Quarterly</option>
                        </select>
                        
                        <input
                            type="date"
                            placeholder="Next due date"
                            value={form.nextDue}
                            onChange={(e) => setForm({ ...form, nextDue: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <button
                            onClick={() => {
                                if (form.name && form.amount) {
                                    onSave({ ...form, amount: parseFloat(form.amount) });
                                }
                            }}
                            className="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-medium"
                        >
                            Add Subscription
                        </button>
                    </div>
                </Modal>
            );
        };

        const AccountModal = ({ onSave, onClose }) => {
            const [form, setForm] = useState({
                name: '',
                type: 'Bank Account',
                balance: '',
                currency: 'TZS'
            });

            return (
                <Modal title="Add Account" onClose={onClose}>
                    <div className="space-y-4">
                        <input
                            type="text"
                            placeholder="Account name"
                            value={form.name}
                            onChange={(e) => setForm({ ...form, name: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        />
                        
                        <select
                            value={form.type}
                            onChange={(e) => setForm({ ...form, type: e.target.value })}
                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                        >
                            {ACCOUNT_TYPES.map(t => (
                                <option key={t} value={t}>{t}</option>
                            ))}
                        </select>
                        
                        <div className="grid grid-cols-2 gap-4">
                            <input
                                type="number"
                                placeholder="Current balance"
                                value={form.balance}
                                onChange={(e) => setForm({ ...form, balance: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            />
                            <select
                                value={form.currency}
                                onChange={(e) => setForm({ ...form, currency: e.target.value })}
                                className="bg-slate-700 border border-slate-600 rounded-lg px-4 py-2"
                            >
                                {Object.keys(CURRENCIES).map(c => (
                                    <option key={c} value={c}>{c}</option>
                                ))}
                            </select>
                        </div>
                        
                        <button
                            onClick={() => {
                                if (form.name) {
                                    onSave({ ...form, balance: parseFloat(form.balance) || 0 });
                                }
                            }}
                            className="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-medium"
                        >
                            Add Account
                        </button>
                    </div>
                </Modal>
            );
        };

        // ==================== RENDER ====================
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
